$(document).ready(function(){function t(){_=parseInt($("#duration-s").val())+60*parseInt($("#duration-m").val())+60*parseInt($("#duration-h").val())*60,localStorage.setItem("lifx_app_duration_s",$("#duration-s").val()),localStorage.setItem("lifx_app_duration_m",$("#duration-m").val()),localStorage.setItem("lifx_app_duration_h",$("#duration-h").val())}function e(){l&&(n.show(),$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+l}}).done(function(t){if(n.hide(),t[0].connected){var e=t[0].brightness;$("#brightness").val(e),$("#current-brightness").html(Math.round(100*e)+"%"),s="id:"+t[0].id,a=t[0].power,$("#power-switch").prop("checked","on"==a),o(),r.show(),p.show()}else d.show()}))}function o(){$("#power-switch").prop("checked","on"==a),$("#fade-btn").html("Fade "+("off"==a?"on":"off"))}var a,l=localStorage.getItem("lifx_app_token"),i=$(".token-alert"),n=$("#spinner-container"),r=$("#settings-link-container"),c=$("#section-settings"),p=$("#section-main"),d=$("#section-offline"),s="all",_=0;l?($("#lifx_app_token").val(l),e()):(i.show(),r.show(),p.hide(),$("#delete-token").hide(),$(".back-btn").hide(),localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock")||$("#delete-all-settings").hide()),localStorage.getItem("lifx_app_duration_s")&&$("#duration-s").val(localStorage.getItem("lifx_app_duration_s")),localStorage.getItem("lifx_app_duration_m")&&$("#duration-m").val(localStorage.getItem("lifx_app_duration_m")),localStorage.getItem("lifx_app_duration_h")&&$("#duration-h").val(localStorage.getItem("lifx_app_duration_h")),t(),localStorage.getItem("lifx_app_quit")&&$("#quit").prop("checked","true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&$("#lock").prop("checked","true"==localStorage.getItem("lifx_app_lock")),window.electron&&$(".electron-only").show(),$(".settings-link").click(function(t){t.preventDefault(),l&&c.is(":visible")?(c.hide(),p.show()):(c.show(),p.hide(),l&&$("#delete-token").show(),(localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&$("#delete-all-settings").show())}),$("#save-token").click(function(){$("#lifx_app_token").val()&&(localStorage.setItem("lifx_app_token",$("#lifx_app_token").val()),l=localStorage.getItem("lifx_app_token"),i.hide(),c.hide(),$(".back-btn").show(),e())}),$("#delete-token").click(function(){localStorage.removeItem("lifx_app_token"),l=localStorage.getItem("lifx_app_token"),$("#lifx_app_token").val(l),i.show(),$("#delete-token").hide(),$(".back-btn").hide()}),$("#delete-all-settings").click(function(){$("#delete-token").click(),localStorage.removeItem("lifx_app_duration_s"),localStorage.removeItem("lifx_app_duration_m"),localStorage.removeItem("lifx_app_duration_h"),$("#duration-s").val(0),$("#duration-m").val(0),$("#duration-h").val(0),localStorage.removeItem("lifx_app_quit"),$("#quit").prop("checked",!1),localStorage.removeItem("lifx_app_lock"),$("#lock").prop("checked",!1),$("#delete-all-settings").hide()}),$(".back-btn").click(function(){c.hide(),p.show()}),$("#power-switch").change(function(){l&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+s+"/state",data:{power:"off"==a?"on":"off",duration:0},headers:{Authorization:"Bearer "+l}}).done(function(t){jQuery.isEmptyObject(t)?(alert("Error."),$("#power-switch").prop("checked","on"==a)):(a="off"==a?"on":"off",o())})}),$("#fade-btn").click(function(){l&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+s+"/state",data:{power:"off"==a?"on":"off",duration:_},headers:{Authorization:"Bearer "+l}}).done(function(t){jQuery.isEmptyObject(t)?alert("Error."):(window.electron&&$("#lock").prop("checked")&&window.electron.lock(),window.electron&&$("#quit").prop("checked")?window.electron.quitApp():(a="off"==a?"on":"off",o()))})}),$("#duration-s, #duration-m, #duration-h").on("input change",function(){t()}),$("#quit").change(function(){localStorage.setItem("lifx_app_quit",$(this).prop("checked"))}),$("#lock").change(function(){localStorage.setItem("lifx_app_lock",$(this).prop("checked"))}),$("#brightness").on("input change",function(){if(l){var t=$(this).val();$("#current-brightness").html(Math.round(100*t)+"%")}}),$("#brightness").on("change",function(){if(l){var t=$(this).val();$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+s+"/state",data:{power:"on",brightness:t,duration:0,fast:!0},headers:{Authorization:"Bearer "+l}})}})});