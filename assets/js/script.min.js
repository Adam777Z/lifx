$(document).ready(function(){function t(){n&&(i.show(),$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+n}}).done(function(t){var n=t[0].brightness;$("#brightness").val(n),$("#current-brightness").html(Math.round(100*n)+"%"),s="id:"+t[0].id,o=t[0].power,e(),i.hide(),l.show(),c.show()}))}function e(){$("#power-btn").html("Turn "+("off"==o?"on":"off")),$("#fade-btn").html("Fade "+("off"==o?"on":"off"))}var o,n=localStorage.getItem("lifx_app_token"),a=$(".token-alert"),i=$("#spinner-container"),l=$("#settings-link-container"),r=$("#section-settings"),c=$("#section-main"),s="all";n?($("#lifx_app_token").val(n),t()):(a.show(),l.show(),c.hide(),$("#delete-token").hide(),$(".back-btn").hide(),localStorage.getItem("lifx_app_duration")||$("#delete-all-settings").hide()),localStorage.getItem("lifx_app_duration")&&($("#duration").val(localStorage.getItem("lifx_app_duration")),$("#second").html(localStorage.getItem("lifx_app_duration")>1?"seconds":"second")),$(".settings-link").click(function(t){t.preventDefault(),n&&r.is(":visible")?(r.hide(),c.show()):(r.show(),c.hide(),n&&$("#delete-token").show(),localStorage.getItem("lifx_app_duration")&&$("#delete-all-settings").show())}),$("#save-token").click(function(){$("#lifx_app_token").val()&&(localStorage.setItem("lifx_app_token",$("#lifx_app_token").val()),n=localStorage.getItem("lifx_app_token"),a.hide(),r.hide(),$(".back-btn").show(),t())}),$("#delete-token").click(function(){localStorage.removeItem("lifx_app_token"),n=localStorage.getItem("lifx_app_token"),$("#lifx_app_token").val(n),a.show(),$("#delete-token").hide(),$(".back-btn").hide()}),$("#delete-all-settings").click(function(){$("#delete-token").click(),localStorage.removeItem("lifx_app_duration"),$("#duration").val(0),$("#delete-all-settings").hide()}),$(".back-btn").click(function(){r.hide(),c.show()}),$("#power-btn").click(function(){n&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+s+"/state",data:{power:"off"==o?"on":"off",duration:0},headers:{Authorization:"Bearer "+n}}).done(function(t){o="off"==o?"on":"off",e()})}),$("#fade-btn").click(function(){n&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+s+"/state",data:{power:"off"==o?"on":"off",duration:$("#duration").val()},headers:{Authorization:"Bearer "+n}}).done(function(t){o="off"==o?"on":"off",e()})}),$("#set-duration-0s").click(function(){$("#duration").val(0).change()}),$("#set-duration-1s").click(function(){$("#duration").val(1).change()}),$("#set-duration-5m").click(function(){$("#duration").val(300).change()}),$("#set-duration-5mq").click(function(){$("#duration").val(300).change(),setTimeout(function(){window.electron.quitApp()},500)}),$("#duration").on("input change",function(){localStorage.setItem("lifx_app_duration",$(this).val()),$("#second").html($(this).val()>1?"seconds":"second")}),$("#brightness").on("input change",function(){if(n){var t=$(this).val();$("#current-brightness").html(Math.round(100*t)+"%")}}),$("#brightness").on("change",function(){if(n){var t=$(this).val();$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+s+"/state",data:{power:"on",brightness:t,duration:"0",fast:!0},headers:{Authorization:"Bearer "+n}})}})});