document.addEventListener("DOMContentLoaded",function(e){function t(){E=parseInt(document.querySelector("#duration-s").value)+60*parseInt(document.querySelector("#duration-m").value)+60*parseInt(document.querySelector("#duration-h").value)*60,localStorage.setItem("lifx_app_duration_s",document.querySelector("#duration-s").value),localStorage.setItem("lifx_app_duration_m",document.querySelector("#duration-m").value),localStorage.setItem("lifx_app_duration_h",document.querySelector("#duration-h").value)}function o(){document.querySelector("#power-switch").checked="on"==c,document.querySelector("#fade-btn").textContent="Fade "+("off"==c?"on":"off"),v[r].power=c}function l(){i&&(s.style.display="block",fetch("https://api.lifx.com/v1/lights/"+x,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{fetch("https://api.lifx.com/v1/lights/"+x,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{s.style.display="none",p.style.display="block",document.querySelector("#debug-info").innerHTML=a(JSON.stringify(e,null,4)),document.querySelector("#debug-info").classList.add("border","border-dark","rounded","p-3"),_.dispatchEvent(new Event("change")),v={},b={},I={},e.forEach(function(e){v[e.id]=e,b[e.group.id]=e.group,b[e.group.id].first_light_id=e.id,I[e.location.id]=e.location,I[e.location.id].first_light_id=e.id}),q.querySelectorAll("option:not(:first-child)").forEach(e=>e.remove());for(let[e,t]of Object.entries(I)){let e=document.createElement("option");e.value=t.id,e.text="Location: "+t.name,e.dataset.type="location",q.add(e)}for(let[e,t]of Object.entries(b)){let e=document.createElement("option");e.value=t.id,e.text="Group: "+t.name,e.dataset.type="group",q.add(e)}for(let[e,t]of Object.entries(v)){let e=document.createElement("option");e.value=t.id,e.text="Light: "+t.label,e.dataset.type="light",q.add(e)}localStorage.getItem("selected")&&(q.value=localStorage.getItem("selected")),q.dispatchEvent(new Event("change")),m.style.display="block"}).catch(e=>{s.style.display="none",p.style.display="block",d.style.display="block",f.style.display="none"})}).catch(e=>{s.style.display="none",p.style.display="block",d.style.display="block",f.style.display="none"}))}function n(e){if(v[e].connected){let t=v[e].brightness;document.querySelector("#brightness").value=t,document.querySelector("#current-brightness").textContent=Math.round(100*t)+"%",c=v[e].power,document.querySelector("#power-switch").checked="on"==c,o(),h.style.display="block"}else h.style.display="none",S.style.display="block"}function a(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){let t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}var r,c,i=localStorage.getItem("lifx_app_token"),d=document.querySelector("#error-alert"),u=document.querySelector("#token-alert"),s=document.querySelector("#spinner-container"),p=document.querySelector("#top-container"),y=document.querySelector("#reload-link"),g=document.querySelector("#section-settings"),m=document.querySelector("#section-lights"),h=document.querySelector("#section-main"),f=document.querySelector("#section-debug"),S=document.querySelector("#section-offline"),_=document.querySelector("#debug-enabled"),k=document.querySelector("#back-btn"),q=document.querySelector('select[id="lights"]'),v={},b={},I={},x="all",E=0;i?(document.querySelector("#lifx_app_token").value=i,y.style.display="block",l()):(u.style.display="block",y.style.display="none",p.style.display="block",h.style.display="none",document.querySelector("#delete-token").style.display="none",k.style.display="none",localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock")||(document.querySelector("#delete-all-settings").style.display="none")),localStorage.getItem("debug_enabled")&&(_.checked="true"==localStorage.getItem("debug_enabled"),_.dispatchEvent(new Event("change"))),localStorage.getItem("lifx_app_duration_s")&&(document.querySelector("#duration-s").value=localStorage.getItem("lifx_app_duration_s")),localStorage.getItem("lifx_app_duration_m")&&(document.querySelector("#duration-m").value=localStorage.getItem("lifx_app_duration_m")),localStorage.getItem("lifx_app_duration_h")&&(document.querySelector("#duration-h").value=localStorage.getItem("lifx_app_duration_h")),t(),localStorage.getItem("lifx_app_quit")&&(document.querySelector("#quit").checked="true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&(document.querySelector("#lock").checked="true"==localStorage.getItem("lifx_app_lock")),window.electron&&document.querySelectorAll(".electron-only").forEach(e=>e.style.display="block"),y.addEventListener("click",function(e){e.preventDefault(),p.style.display="none",m.style.display="none",h.style.display="none",S.style.display="none",f.style.display="none",l()}),document.querySelector(".settings-link").addEventListener("click",function(e){e.preventDefault(),i&&"none"!=g.style.display?(g.style.display="none",y.style.display="block","none"!=!d.style.display&&(q.dispatchEvent(new Event("change")),m.style.display="block")):(g.style.display="block",y.style.display="none",m.style.display="none",h.style.display="none",S.style.display="none",i&&(document.querySelector("#delete-token").style.display="block"),(localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&(document.querySelector("#delete-all-settings").style.display="block"))}),document.querySelector("#save-token").addEventListener("click",function(e){document.querySelector("#lifx_app_token").value?(localStorage.setItem("lifx_app_token",document.querySelector("#lifx_app_token").value),i=localStorage.getItem("lifx_app_token"),d.style.display="none",u.style.display="none",g.style.display="none",k.style.display="block",y.style.display="block",l()):document.querySelector("#delete-token").click()}),document.querySelector("#delete-token").addEventListener("click",function(e){localStorage.removeItem("lifx_app_token"),i=localStorage.getItem("lifx_app_token"),document.querySelector("#lifx_app_token").value=i,d.style.display="none",u.style.display="block",document.querySelector("#delete-token").style.display="none",k.style.display="none",y.style.display="none"}),document.querySelector("#delete-all-settings").addEventListener("click",function(e){document.querySelector("#delete-token").click(),localStorage.removeItem("debug_enabled"),_.checked=!1,q.value="all",localStorage.removeItem("selected"),localStorage.removeItem("lifx_app_duration_s"),localStorage.removeItem("lifx_app_duration_m"),localStorage.removeItem("lifx_app_duration_h"),document.querySelector("#duration-s").value=0,document.querySelector("#duration-m").value=0,document.querySelector("#duration-h").value=0,localStorage.removeItem("lifx_app_quit"),document.querySelector("#quit").checked=!1,localStorage.removeItem("lifx_app_lock"),document.querySelector("#lock").checked=!1,document.querySelector("#delete-all-settings").style.display="none"}),_.addEventListener("change",function(e){e.target.checked?(localStorage.setItem("debug_enabled",e.target.checked),f.style.display="block"):(localStorage.removeItem("debug_enabled"),f.style.display="none")}),k.addEventListener("click",function(e){g.style.display="none",y.style.display="block",i&&"none"!=!d.style.display&&(q.dispatchEvent(new Event("change")),m.style.display="block")}),document.querySelector("#power-switch").addEventListener("change",function(e){i&&fetch("https://api.lifx.com/v1/lights/"+x+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({power:"off"==c?"on":"off",duration:0}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{0!==Object.keys(e).length?(c="off"==c?"on":"off",o()):(alert("Error."),document.querySelector("#power-switch").checked="on"==c)}).catch(e=>{})}),document.querySelector("#fade-btn").addEventListener("click",function(e){i&&fetch("https://api.lifx.com/v1/lights/"+x+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({power:"off"==c?"on":"off",duration:E}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{0!==Object.keys(e).length?(window.electron&&document.querySelector("#lock").checked&&window.electron.lock(),window.electron&&document.querySelector("#quit").checked?window.electron.quitApp():(c="off"==c?"on":"off",o())):alert("Error.")}).catch(e=>{})}),document.querySelectorAll("#duration-s, #duration-m, #duration-h").forEach(e=>["input","change"].forEach(o=>e.addEventListener(o,()=>t()))),document.querySelector("#quit").addEventListener("change",function(e){e.target.checked?localStorage.setItem("lifx_app_quit",e.target.checked):localStorage.removeItem("lifx_app_quit")}),document.querySelector("#lock").addEventListener("change",function(e){e.target.checked?localStorage.setItem("lifx_app_lock",e.target.checked):localStorage.removeItem("lifx_app_lock")}),["input","change"].forEach(e=>document.querySelector("#brightness").addEventListener(e,e=>{if(i){let t=parseFloat(e.target.value);document.querySelector("#current-brightness").textContent=Math.round(100*t)+"%"}})),document.querySelector("#brightness").addEventListener("change",function(e){if(i){let t=parseFloat(e.target.value);fetch("https://api.lifx.com/v1/lights/"+x+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({power:"on",brightness:t,duration:0,fast:!0}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{}).catch(e=>{})}}),q.addEventListener("change",function(e){r=e.target.value,localStorage.setItem("selected",r);let t="all"!=r?e.target.selectedOptions[0].dataset.type:"",o="";"light"==t?o="id:":"group"==t?o="group_id:":"location"==t&&(o="location_id:"),x=o+r,"all"==r?r=e.target.querySelector('option[data-type="light"]').value:"group"==t?r=b[r].first_light_id:"location"==t&&(r=I[r].first_light_id),n(r)})});