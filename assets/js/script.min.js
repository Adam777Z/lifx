$(document).ready(function(){function e(){w=parseInt($("#duration-s").val())+60*parseInt($("#duration-m").val())+60*parseInt($("#duration-h").val())*60,localStorage.setItem("lifx_app_duration_s",$("#duration-s").val()),localStorage.setItem("lifx_app_duration_m",$("#duration-m").val()),localStorage.setItem("lifx_app_duration_h",$("#duration-h").val())}function t(){$("#power-switch").prop("checked","on"==n),$("#fade-btn").html("Fade "+("off"==n?"on":"off")),I[i].power=n}function o(){r&&(p.show(),$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/"+b,headers:{Authorization:"Bearer "+r}}).done(function(e){$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/"+b,headers:{Authorization:"Bearer "+r}}).done(function(e){p.hide(),h.show(),$("#debug-info").html(l(JSON.stringify(e,null,4))).addClass("border border-dark rounded p-3"),k.change(),I={},x={},S={},e.forEach(function(e){I[e.id]=e,x[e.group.id]=e.group,x[e.group.id].first_light_id=e.id,S[e.location.id]=e.location,S[e.location.id].first_light_id=e.id}),v.find("option").slice(1).remove(),$.each(S,function(e,t){v.append('<option value="'+t.id+'" data-type="location">Location: '+t.name+"</option>")}),$.each(x,function(e,t){v.append('<option value="'+t.id+'" data-type="group">Group: '+t.name+"</option>")}),$.each(I,function(e,t){v.append('<option value="'+t.id+'" data-type="light">Light: '+t.label+"</option>")}),localStorage.getItem("selected")&&v.val(localStorage.getItem("selected")),v.change(),u.show()}).fail(function(e){p.hide(),h.show(),c.show(),_.hide()})}).fail(function(e){p.hide(),h.show(),c.show(),_.hide()}))}function a(e){if(I[e].connected){var o=I[e].brightness;$("#brightness").val(o),$("#current-brightness").html(Math.round(100*o)+"%"),n=I[e].power,$("#power-switch").prop("checked","on"==n),t(),f.show()}else f.hide(),m.show()}function l(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}var i,n,r=localStorage.getItem("lifx_app_token"),c=$("#error-alert"),d=$("#token-alert"),p=$("#spinner-container"),h=$("#top-container"),s=$(".reload-link"),g=$("#section-settings"),u=$("#section-lights"),f=$("#section-main"),_=$("#section-debug"),m=$("#section-offline"),k=$("#debug-enabled"),v=$('select[id="lights"]'),I={},x={},S={},b="all",w=0;r?($("#lifx_app_token").val(r),s.show(),o()):(d.show(),s.hide(),h.show(),f.hide(),$("#delete-token").hide(),$(".back-btn").hide(),localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock")||$("#delete-all-settings").hide()),localStorage.getItem("debug_enabled")&&k.prop("checked","true"==localStorage.getItem("debug_enabled")).change(),localStorage.getItem("lifx_app_duration_s")&&$("#duration-s").val(localStorage.getItem("lifx_app_duration_s")),localStorage.getItem("lifx_app_duration_m")&&$("#duration-m").val(localStorage.getItem("lifx_app_duration_m")),localStorage.getItem("lifx_app_duration_h")&&$("#duration-h").val(localStorage.getItem("lifx_app_duration_h")),e(),localStorage.getItem("lifx_app_quit")&&$("#quit").prop("checked","true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&$("#lock").prop("checked","true"==localStorage.getItem("lifx_app_lock")),window.electron&&$(".electron-only").show(),s.click(function(e){e.preventDefault(),h.hide(),u.hide(),f.hide(),m.hide(),_.hide(),o()}),$(".settings-link").click(function(e){e.preventDefault(),r&&g.is(":visible")?(g.hide(),s.show(),c.is(":visible")||(v.change(),u.show())):(g.show(),s.hide(),u.hide(),f.hide(),m.hide(),r&&$("#delete-token").show(),(localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&$("#delete-all-settings").show())}),$("#save-token").click(function(){$("#lifx_app_token").val()?(localStorage.setItem("lifx_app_token",$("#lifx_app_token").val()),r=localStorage.getItem("lifx_app_token"),c.hide(),d.hide(),g.hide(),$(".back-btn").show(),s.show(),o()):$("#delete-token").click()}),$("#delete-token").click(function(){localStorage.removeItem("lifx_app_token"),r=localStorage.getItem("lifx_app_token"),$("#lifx_app_token").val(r),c.hide(),d.show(),$("#delete-token").hide(),$(".back-btn").hide(),s.hide()}),$("#delete-all-settings").click(function(){$("#delete-token").click(),localStorage.removeItem("debug_enabled"),k.prop("checked",!1),v.val("all"),localStorage.removeItem("selected"),localStorage.removeItem("lifx_app_duration_s"),localStorage.removeItem("lifx_app_duration_m"),localStorage.removeItem("lifx_app_duration_h"),$("#duration-s").val(0),$("#duration-m").val(0),$("#duration-h").val(0),localStorage.removeItem("lifx_app_quit"),$("#quit").prop("checked",!1),localStorage.removeItem("lifx_app_lock"),$("#lock").prop("checked",!1),$("#delete-all-settings").hide()}),k.change(function(){$(this).prop("checked")?(localStorage.setItem("debug_enabled",$(this).prop("checked")),_.show()):(localStorage.removeItem("debug_enabled"),_.hide())}),$(".back-btn").click(function(){g.hide(),s.show(),r&&!c.is(":visible")&&(v.change(),u.show())}),$("#power-switch").change(function(){r&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+b+"/state",data:{power:"off"==n?"on":"off",duration:0},headers:{Authorization:"Bearer "+r}}).done(function(e){jQuery.isEmptyObject(e)?(alert("Error."),$("#power-switch").prop("checked","on"==n)):(n="off"==n?"on":"off",t())})}),$("#fade-btn").click(function(){r&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+b+"/state",data:{power:"off"==n?"on":"off",duration:w},headers:{Authorization:"Bearer "+r}}).done(function(e){jQuery.isEmptyObject(e)?alert("Error."):(window.electron&&$("#lock").prop("checked")&&window.electron.lock(),window.electron&&$("#quit").prop("checked")?window.electron.quitApp():(n="off"==n?"on":"off",t()))})}),$("#duration-s, #duration-m, #duration-h").on("input change",function(){e()}),$("#quit").change(function(){$(this).prop("checked")?localStorage.setItem("lifx_app_quit",$(this).prop("checked")):localStorage.removeItem("lifx_app_quit")}),$("#lock").change(function(){$(this).prop("checked")?localStorage.setItem("lifx_app_lock",$(this).prop("checked")):localStorage.removeItem("lifx_app_lock")}),$("#brightness").on("input change",function(){if(r){var e=$(this).val();$("#current-brightness").html(Math.round(100*e)+"%")}}),$("#brightness").on("change",function(){if(r){var e=$(this).val();$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+b+"/state",data:{power:"on",brightness:e,duration:0,fast:!0},headers:{Authorization:"Bearer "+r}})}}),v.on("change",function(){i=$(this).val(),localStorage.setItem("selected",i);let e=$(this).find("option:selected").data("type"),t="";"light"==e?t="id:":"group"==e?t="group_id:":"location"==e&&(t="location_id:"),b=t+i,"all"==i?i=$(this).find('option[data-type="light"]').first().val():"group"==e?i=x[i].first_light_id:"location"==e&&(i=S[i].first_light_id),a(i)})});