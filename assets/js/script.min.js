document.addEventListener("DOMContentLoaded",e=>{function t(){j=parseInt(document.querySelector("#duration-s").value)+60*parseInt(document.querySelector("#duration-m").value)+60*parseInt(document.querySelector("#duration-h").value)*60,localStorage.setItem("lifx_app_duration_s",document.querySelector("#duration-s").value),localStorage.setItem("lifx_app_duration_m",document.querySelector("#duration-m").value),localStorage.setItem("lifx_app_duration_h",document.querySelector("#duration-h").value)}function o(){document.querySelector("#power-switch").checked="on"==c,document.querySelector("#fade-btn").textContent="Fade "+("off"==c?"on":"off"),x[r].power=c}function l(){i&&(u.style.display="block",fetch("https://api.lifx.com/v1/lights/"+L,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{fetch("https://api.lifx.com/v1/lights/"+L,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{u.style.display="none",p.style.display="block",document.querySelector("#debug-info").innerHTML=n(JSON.stringify(e,null,4)),document.querySelector("#debug-info").classList.add("border","border-dark","rounded","p-3"),b.dispatchEvent(new Event("change")),x={},E={},w={},e.forEach(function(e){x[e.id]=e,E[e.group.id]=e.group,E[e.group.id].first_light_id=e.id,w[e.location.id]=e.location,w[e.location.id].first_light_id=e.id}),I.querySelectorAll("option:not(:first-child)").forEach(e=>e.remove());for(let[e,t]of Object.entries(w)){let e=document.createElement("option");e.value=t.id,e.text="Location: "+t.name,e.dataset.type="location",I.add(e)}for(let[e,t]of Object.entries(E)){let e=document.createElement("option");e.value=t.id,e.text="Group: "+t.name,e.dataset.type="group",I.add(e)}for(let[e,t]of Object.entries(x)){let e=document.createElement("option");e.value=t.id,e.text="Light: "+t.label,e.dataset.type="light",I.add(e)}localStorage.getItem("selected")&&(I.value=localStorage.getItem("selected")),I.dispatchEvent(new Event("change")),h.style.display="block"}).catch(e=>{u.style.display="none",p.style.display="block",d.style.display="block",_.style.display="none"})}).catch(e=>{u.style.display="none",p.style.display="block",d.style.display="block",_.style.display="none"}))}function a(e){if(x[e].connected){let t=x[e].brightness;document.querySelector("#brightness").value=t,document.querySelector("#current-brightness").textContent=Math.round(100*t)+"%",c=x[e].power,document.querySelector("#power-switch").checked="on"==c,o(),f.style.display="block"}else f.style.display="none",S.style.display="block"}function n(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){let t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}var r,c,i=localStorage.getItem("lifx_app_token"),d=document.querySelector("#error-alert"),s=document.querySelector("#token-alert"),u=document.querySelector("#spinner-container"),p=document.querySelector("#top-container"),y=document.querySelector("#github-link"),g=document.querySelector("#reload-link"),m=document.querySelector("#section-settings"),h=document.querySelector("#section-lights"),f=document.querySelector("#section-main"),_=document.querySelector("#section-debug"),S=document.querySelector("#section-offline"),k=document.querySelector("#delete-token-btn"),v=document.querySelector("#delete-all-settings-btn"),b=document.querySelector("#debug-enabled"),q=document.querySelector("#back-btn"),I=document.querySelector('select[id="lights"]'),x={},E={},w={},L="all",j=0;i?(document.querySelector("#lifx_app_token").value=i,g.style.display="block",l()):(s.style.display="block",p.style.display="block",f.style.display="none",k.style.display="none",q.style.display="none",localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock")||(v.style.display="none")),localStorage.getItem("debug_enabled")&&(b.checked="true"==localStorage.getItem("debug_enabled"),b.dispatchEvent(new Event("change"))),localStorage.getItem("lifx_app_duration_s")&&(document.querySelector("#duration-s").value=localStorage.getItem("lifx_app_duration_s")),localStorage.getItem("lifx_app_duration_m")&&(document.querySelector("#duration-m").value=localStorage.getItem("lifx_app_duration_m")),localStorage.getItem("lifx_app_duration_h")&&(document.querySelector("#duration-h").value=localStorage.getItem("lifx_app_duration_h")),t(),localStorage.getItem("lifx_app_quit")&&(document.querySelector("#quit").checked="true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&(document.querySelector("#lock").checked="true"==localStorage.getItem("lifx_app_lock")),window.electron&&document.querySelectorAll(".electron-only").forEach(e=>e.style.display=null),g.addEventListener("click",e=>{e.preventDefault(),p.style.display="none",h.style.display="none",f.style.display="none",S.style.display="none",_.style.display="none",l()}),document.querySelector(".settings-link").addEventListener("click",e=>{e.preventDefault(),i&&"none"!=window.getComputedStyle(m).display?(m.style.display="none",y.style.display="none",g.style.display="block","none"==window.getComputedStyle(d).display&&(I.dispatchEvent(new Event("change")),h.style.display="block")):(m.style.display="block",y.style.display="block",g.style.display="none",h.style.display="none",f.style.display="none",S.style.display="none",i?(k.style.display="block",q.style.display="block"):(k.style.display="none",q.style.display="none"),(localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&(v.style.display="block"))}),document.querySelector("#save-token").addEventListener("click",e=>{document.querySelector("#lifx_app_token").value?(localStorage.setItem("lifx_app_token",document.querySelector("#lifx_app_token").value),i=localStorage.getItem("lifx_app_token"),d.style.display="none",s.style.display="none",m.style.display="none",y.style.display="none",g.style.display="block",l()):k.click()}),k.addEventListener("click",e=>{localStorage.removeItem("lifx_app_token"),i=localStorage.getItem("lifx_app_token"),document.querySelector("#lifx_app_token").value=i,d.style.display="none",s.style.display="block",k.style.display="none",g.style.display="none",q.style.display="none"}),v.addEventListener("click",e=>{k.click(),localStorage.removeItem("debug_enabled"),b.checked=!1,I.value="all",localStorage.removeItem("selected"),localStorage.removeItem("lifx_app_duration_s"),localStorage.removeItem("lifx_app_duration_m"),localStorage.removeItem("lifx_app_duration_h"),document.querySelector("#duration-s").value=0,document.querySelector("#duration-m").value=0,document.querySelector("#duration-h").value=0,localStorage.removeItem("lifx_app_quit"),document.querySelector("#quit").checked=!1,localStorage.removeItem("lifx_app_lock"),document.querySelector("#lock").checked=!1,v.style.display="none"}),b.addEventListener("change",e=>{e.target.checked?(localStorage.setItem("debug_enabled",e.target.checked),_.style.display="block"):(localStorage.removeItem("debug_enabled"),_.style.display="none")}),q.addEventListener("click",e=>{m.style.display="none",y.style.display="none",g.style.display="block",i&&"none"==window.getComputedStyle(d).display&&(I.dispatchEvent(new Event("change")),h.style.display="block")}),document.querySelector("#power-switch").addEventListener("change",e=>{i&&fetch("https://api.lifx.com/v1/lights/"+L+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({power:"off"==c?"on":"off",duration:0}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{0!==Object.keys(e).length?(c="off"==c?"on":"off",o()):(alert("Error."),document.querySelector("#power-switch").checked="on"==c)}).catch(e=>{})}),document.querySelector("#fade-btn").addEventListener("click",e=>{i&&fetch("https://api.lifx.com/v1/lights/"+L+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({power:"off"==c?"on":"off",duration:j}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{0!==Object.keys(e).length?(window.electron&&document.querySelector("#lock").checked&&window.electron.lock(),window.electron&&document.querySelector("#quit").checked?window.electron.quitApp():(c="off"==c?"on":"off",o())):alert("Error.")}).catch(e=>{})}),document.querySelectorAll("#duration-s, #duration-m, #duration-h").forEach(e=>{["input","change"].forEach(o=>{e.addEventListener(o,e=>{t()})})}),document.querySelector("#quit").addEventListener("change",e=>{e.target.checked?localStorage.setItem("lifx_app_quit",e.target.checked):localStorage.removeItem("lifx_app_quit")}),document.querySelector("#lock").addEventListener("change",e=>{e.target.checked?localStorage.setItem("lifx_app_lock",e.target.checked):localStorage.removeItem("lifx_app_lock")}),["input","change"].forEach(e=>document.querySelector("#brightness").addEventListener(e,e=>{if(i){let t=parseFloat(e.target.value);document.querySelector("#current-brightness").textContent=Math.round(100*t)+"%"}})),document.querySelector("#brightness").addEventListener("change",e=>{if(i){let t=parseFloat(e.target.value);fetch("https://api.lifx.com/v1/lights/"+L+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify({power:"on",brightness:t,duration:0,fast:!0}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{}).catch(e=>{})}}),I.addEventListener("change",e=>{r=e.target.value,localStorage.setItem("selected",r);let t="all"!=r?e.target.selectedOptions[0].dataset.type:"",o="";"light"==t?o="id:":"group"==t?o="group_id:":"location"==t&&(o="location_id:"),L=o+r,"all"==r?r=e.target.querySelector('option[data-type="light"]').value:"group"==t?r=E[r].first_light_id:"location"==t&&(r=w[r].first_light_id),a(r)})});