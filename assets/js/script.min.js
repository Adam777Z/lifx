$(document).ready(function(){function e(){h=parseInt($("#duration-s").val())+60*parseInt($("#duration-m").val())+60*parseInt($("#duration-h").val())*60,localStorage.setItem("lifx_app_duration_s",$("#duration-s").val()),localStorage.setItem("lifx_app_duration_m",$("#duration-m").val()),localStorage.setItem("lifx_app_duration_h",$("#duration-h").val())}function t(){i&&(r.show(),$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+i}}).done(function(e){$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+i}}).done(function(e){if(r.hide(),$("#debug-enabled").prop("checked")&&$("#debug-info").html(a(JSON.stringify(e,null,4))).show(),e[0].connected){var t=e[0].brightness;$("#brightness").val(t),$("#current-brightness").html(Math.round(100*t)+"%"),g="id:"+e[0].id,l=e[0].power,$("#power-switch").prop("checked","on"==l),o(),c.show(),d.show()}else u.show()})}))}function o(){$("#power-switch").prop("checked","on"==l),$("#fade-btn").html("Fade "+("off"==l?"on":"off"))}function a(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}var l,i=localStorage.getItem("lifx_app_token"),n=$(".token-alert"),r=$("#spinner-container"),c=$("#settings-link-container"),p=$("#section-settings"),d=$("#section-main"),s=$("#section-debug"),u=$("#section-offline"),g="all",h=0;if(i?($("#lifx_app_token").val(i),t()):(n.show(),c.show(),d.hide(),$("#delete-token").hide(),$(".back-btn").hide(),localStorage.getItem("debug_enabled")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock")||$("#delete-all-settings").hide()),localStorage.getItem("debug_enabled")){var _="true"==localStorage.getItem("debug_enabled");$("#debug-enabled").prop("checked",_),_&&s.show()}localStorage.getItem("lifx_app_duration_s")&&$("#duration-s").val(localStorage.getItem("lifx_app_duration_s")),localStorage.getItem("lifx_app_duration_m")&&$("#duration-m").val(localStorage.getItem("lifx_app_duration_m")),localStorage.getItem("lifx_app_duration_h")&&$("#duration-h").val(localStorage.getItem("lifx_app_duration_h")),e(),localStorage.getItem("lifx_app_quit")&&$("#quit").prop("checked","true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&$("#lock").prop("checked","true"==localStorage.getItem("lifx_app_lock")),window.electron&&$(".electron-only").show(),$(".settings-link").click(function(e){e.preventDefault(),i&&p.is(":visible")?(p.hide(),d.show()):(p.show(),d.hide(),i&&$("#delete-token").show(),(localStorage.getItem("debug_enabled")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&$("#delete-all-settings").show())}),$("#save-token").click(function(){$("#lifx_app_token").val()&&(localStorage.setItem("lifx_app_token",$("#lifx_app_token").val()),i=localStorage.getItem("lifx_app_token"),n.hide(),p.hide(),$(".back-btn").show(),t())}),$("#delete-token").click(function(){localStorage.removeItem("lifx_app_token"),i=localStorage.getItem("lifx_app_token"),$("#lifx_app_token").val(i),n.show(),$("#delete-token").hide(),$(".back-btn").hide()}),$("#delete-all-settings").click(function(){$("#delete-token").click(),localStorage.removeItem("debug_enabled"),$("#debug-enabled").prop("checked",!1),localStorage.removeItem("lifx_app_duration_s"),localStorage.removeItem("lifx_app_duration_m"),localStorage.removeItem("lifx_app_duration_h"),$("#duration-s").val(0),$("#duration-m").val(0),$("#duration-h").val(0),localStorage.removeItem("lifx_app_quit"),$("#quit").prop("checked",!1),localStorage.removeItem("lifx_app_lock"),$("#lock").prop("checked",!1),$("#delete-all-settings").hide()}),$("#debug-enabled").change(function(){$(this).prop("checked")?(localStorage.setItem("debug_enabled",$(this).prop("checked")),s.show()):(localStorage.removeItem("debug_enabled"),s.hide())}),$(".back-btn").click(function(){p.hide(),d.show()}),$("#power-switch").change(function(){i&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+g+"/state",data:{power:"off"==l?"on":"off",duration:0},headers:{Authorization:"Bearer "+i}}).done(function(e){jQuery.isEmptyObject(e)?(alert("Error."),$("#power-switch").prop("checked","on"==l)):(l="off"==l?"on":"off",o())})}),$("#fade-btn").click(function(){i&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+g+"/state",data:{power:"off"==l?"on":"off",duration:h},headers:{Authorization:"Bearer "+i}}).done(function(e){jQuery.isEmptyObject(e)?alert("Error."):(window.electron&&$("#lock").prop("checked")&&window.electron.lock(),window.electron&&$("#quit").prop("checked")?window.electron.quitApp():(l="off"==l?"on":"off",o()))})}),$("#duration-s, #duration-m, #duration-h").on("input change",function(){e()}),$("#quit").change(function(){$(this).prop("checked")?localStorage.setItem("lifx_app_quit",$(this).prop("checked")):localStorage.removeItem("lifx_app_quit")}),$("#lock").change(function(){$(this).prop("checked")?localStorage.setItem("lifx_app_lock",$(this).prop("checked")):localStorage.removeItem("lifx_app_lock")}),$("#brightness").on("input change",function(){if(i){var e=$(this).val();$("#current-brightness").html(Math.round(100*e)+"%")}}),$("#brightness").on("change",function(){if(i){var e=$(this).val();$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+g+"/state",data:{power:"on",brightness:e,duration:0,fast:!0},headers:{Authorization:"Bearer "+i}})}})});