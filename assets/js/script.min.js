$(document).ready(function(){function e(){x=parseInt($("#duration-s").val())+60*parseInt($("#duration-m").val())+60*parseInt($("#duration-h").val())*60,localStorage.setItem("lifx_app_duration_s",$("#duration-s").val()),localStorage.setItem("lifx_app_duration_m",$("#duration-m").val()),localStorage.setItem("lifx_app_duration_h",$("#duration-h").val())}function t(){$("#power-switch").prop("checked","on"==n),$("#fade-btn").html("Fade "+("off"==n?"on":"off")),m[i].power=n}function o(){r&&(p.show(),$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/"+v,headers:{Authorization:"Bearer "+r}}).done(function(e){$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/"+v,headers:{Authorization:"Bearer "+r}}).done(function(e){p.hide(),d.show(),$("#debug-enabled").prop("checked")&&$("#debug-info").html(l(JSON.stringify(e,null,4))).show(),m={},k={},I={},e.forEach(function(e){m[e.id]=e,k[e.group.id]=e.group,k[e.group.id].first_light_id=e.id,I[e.location.id]=e.location,I[e.location.id].first_light_id=e.id}),$.each(I,function(e,t){_.append('<option value="'+t.id+'" data-type="location">Location: '+t.name+"</option>")}),$.each(k,function(e,t){_.append('<option value="'+t.id+'" data-type="group">Group: '+t.name+"</option>")}),$.each(m,function(e,t){_.append('<option value="'+t.id+'" data-type="light">Light: '+t.label+"</option>")}),localStorage.getItem("selected")&&_.val(localStorage.getItem("selected")),_.change(),h.show()})}))}function a(e){if(m[e].connected){var o=m[e].brightness;$("#brightness").val(o),$("#current-brightness").html(Math.round(100*o)+"%"),n=m[e].power,$("#power-switch").prop("checked","on"==n),t(),s.show()}else s.hide(),f.show()}function l(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}var i,n,r=localStorage.getItem("lifx_app_token"),c=$(".token-alert"),p=$("#spinner-container"),d=$("#settings-link-container"),g=$("#section-settings"),h=$("#section-lights"),s=$("#section-main"),u=$("#section-debug"),f=$("#section-offline"),_=$('select[id="lights"]'),m={},k={},I={},v="all",x=0;if(r?($("#lifx_app_token").val(r),o()):(c.show(),d.show(),s.hide(),$("#delete-token").hide(),$(".back-btn").hide(),localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock")||$("#delete-all-settings").hide()),localStorage.getItem("debug_enabled")){var S="true"==localStorage.getItem("debug_enabled");$("#debug-enabled").prop("checked",S),S&&u.show()}localStorage.getItem("lifx_app_duration_s")&&$("#duration-s").val(localStorage.getItem("lifx_app_duration_s")),localStorage.getItem("lifx_app_duration_m")&&$("#duration-m").val(localStorage.getItem("lifx_app_duration_m")),localStorage.getItem("lifx_app_duration_h")&&$("#duration-h").val(localStorage.getItem("lifx_app_duration_h")),e(),localStorage.getItem("lifx_app_quit")&&$("#quit").prop("checked","true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&$("#lock").prop("checked","true"==localStorage.getItem("lifx_app_lock")),window.electron&&$(".electron-only").show(),$(".settings-link").click(function(e){e.preventDefault(),r&&g.is(":visible")?(g.hide(),h.show(),_.change()):(g.show(),h.hide(),s.hide(),f.hide(),r&&$("#delete-token").show(),(localStorage.getItem("debug_enabled")||localStorage.getItem("selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&$("#delete-all-settings").show())}),$("#save-token").click(function(){$("#lifx_app_token").val()&&(localStorage.setItem("lifx_app_token",$("#lifx_app_token").val()),r=localStorage.getItem("lifx_app_token"),c.hide(),g.hide(),$(".back-btn").show(),o())}),$("#delete-token").click(function(){localStorage.removeItem("lifx_app_token"),r=localStorage.getItem("lifx_app_token"),$("#lifx_app_token").val(r),c.show(),$("#delete-token").hide(),$(".back-btn").hide()}),$("#delete-all-settings").click(function(){$("#delete-token").click(),localStorage.removeItem("debug_enabled"),$("#debug-enabled").prop("checked",!1),_.val("all"),localStorage.removeItem("selected"),localStorage.removeItem("lifx_app_duration_s"),localStorage.removeItem("lifx_app_duration_m"),localStorage.removeItem("lifx_app_duration_h"),$("#duration-s").val(0),$("#duration-m").val(0),$("#duration-h").val(0),localStorage.removeItem("lifx_app_quit"),$("#quit").prop("checked",!1),localStorage.removeItem("lifx_app_lock"),$("#lock").prop("checked",!1),$("#delete-all-settings").hide()}),$("#debug-enabled").change(function(){$(this).prop("checked")?(localStorage.setItem("debug_enabled",$(this).prop("checked")),u.show()):(localStorage.removeItem("debug_enabled"),u.hide())}),$(".back-btn").click(function(){g.hide(),h.show(),_.change()}),$("#power-switch").change(function(){r&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+v+"/state",data:{power:"off"==n?"on":"off",duration:0},headers:{Authorization:"Bearer "+r}}).done(function(e){jQuery.isEmptyObject(e)?(alert("Error."),$("#power-switch").prop("checked","on"==n)):(n="off"==n?"on":"off",t())})}),$("#fade-btn").click(function(){r&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+v+"/state",data:{power:"off"==n?"on":"off",duration:x},headers:{Authorization:"Bearer "+r}}).done(function(e){jQuery.isEmptyObject(e)?alert("Error."):(window.electron&&$("#lock").prop("checked")&&window.electron.lock(),window.electron&&$("#quit").prop("checked")?window.electron.quitApp():(n="off"==n?"on":"off",t()))})}),$("#duration-s, #duration-m, #duration-h").on("input change",function(){e()}),$("#quit").change(function(){$(this).prop("checked")?localStorage.setItem("lifx_app_quit",$(this).prop("checked")):localStorage.removeItem("lifx_app_quit")}),$("#lock").change(function(){$(this).prop("checked")?localStorage.setItem("lifx_app_lock",$(this).prop("checked")):localStorage.removeItem("lifx_app_lock")}),$("#brightness").on("input change",function(){if(r){var e=$(this).val();$("#current-brightness").html(Math.round(100*e)+"%")}}),$("#brightness").on("change",function(){if(r){var e=$(this).val();$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+v+"/state",data:{power:"on",brightness:e,duration:0,fast:!0},headers:{Authorization:"Bearer "+r}})}}),_.on("change",function(){i=$(this).val(),localStorage.setItem("selected",i);let e=$(this).find("option:selected").data("type"),t="";"light"==e?t="id:":"group"==e?t="group_id:":"location"==e&&(t="location_id:"),v=t+i,"all"==i?i=$(this).find('option[data-type="light"]').first().val():"group"==e?i=k[i].first_light_id:"location"==e&&(i=I[i].first_light_id),a(i)})});