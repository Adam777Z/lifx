$(document).ready(function(){function t(){o&&(a.show(),$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+o}}).done(function(t){var o=t[0].brightness;$("#brightness").val(o),$("#current-brightness").html(Math.round(100*o)+"%"),c="id:"+t[0].id,e=t[0].power,$("#power-btn").html("Turn "+("off"==e?"on":"off")),$("#fade-btn").html("Fade "+("off"==e?"on":"off")),a.hide(),n.show(),r.show()}))}var e,o=localStorage.getItem("lifx_app_token"),i=$(".token-alert"),a=$("#spinner-container"),n=$("#settings-link-container"),l=$("#section-settings"),r=$("#section-main"),c="all";o?($("#lifx_app_token").val(o),t()):(i.show(),n.show(),r.hide(),$("#delete-token").hide(),$(".back-btn").hide(),localStorage.getItem("lifx_app_duration")||$("#delete-all-settings").hide()),localStorage.getItem("lifx_app_duration")?$("#duration").val(localStorage.getItem("lifx_app_duration")):($("#duration").val("0"),localStorage.setItem("lifx_app_duration","0")),$(".settings-link").click(function(t){t.preventDefault(),o&&l.is(":visible")?(l.hide(),r.show()):(l.show(),r.hide(),o&&$("#delete-token").show(),localStorage.getItem("lifx_app_duration")&&$("#delete-all-settings").show())}),$("#save-token").click(function(){$("#lifx_app_token").val()&&(localStorage.setItem("lifx_app_token",$("#lifx_app_token").val()),o=localStorage.getItem("lifx_app_token"),i.hide(),l.hide(),$(".back-btn").show(),t())}),$("#delete-token").click(function(){localStorage.removeItem("lifx_app_token"),o=localStorage.getItem("lifx_app_token"),$("#lifx_app_token").val(o),i.show(),$("#delete-token").hide(),$(".back-btn").hide()}),$("#delete-all-settings").click(function(){$("#delete-token").click(),localStorage.removeItem("lifx_app_duration"),$("#duration").val("0"),$("#delete-all-settings").hide()}),$(".back-btn").click(function(){l.hide(),r.show()}),$("#power-btn").click(function(){if(o){var t=$(this);$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+c+"/state",data:{power:"off"==e?"on":"off",duration:"0",fast:!0},headers:{Authorization:"Bearer "+o}}).done(function(o){e="off"==e?"on":"off",t.html("Turn "+("off"==e?"on":"off"))})}}),$("#fade-btn").click(function(){o&&$.ajax({method:"POST",url:"https://api.lifx.com/v1/lights/"+c+"/toggle",data:{duration:$("#duration").val()},headers:{Authorization:"Bearer "+o}})}),$("#toggle-0s").click(function(){$("#duration").val(0),$("#toggle").click()}),$("#toggle-1s").click(function(){$("#duration").val(1),$("#toggle").click()}),$("#toggle-5m").click(function(){$("#duration").val(300),$("#toggle").click()}),$("#toggle-5mq").click(function(){$("#duration").val(300),$("#toggle").click(),setTimeout(function(){window.electron.quitApp()},500)}),$("#duration").on("input change",function(){localStorage.setItem("lifx_app_duration",$(this).val())}),$("#brightness").on("input change",function(){if(o){var t=$(this).val();$("#current-brightness").html(Math.round(100*t)+"%")}}),$("#brightness").on("change",function(){if(o){var t=$(this).val();$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+c+"/state",data:{power:"on",brightness:t,duration:"0",fast:!0},headers:{Authorization:"Bearer "+o}})}})});