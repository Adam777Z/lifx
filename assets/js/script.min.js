$(document).ready(function(){function e(){a&&(n.show(),$.ajax({method:"GET",url:"https://api.lifx.com/v1/lights/all",headers:{Authorization:"Bearer "+a}}).done(function(e){var a=e[0].brightness;$("#brightness").val(a),$("#current-brightness").html(Math.round(100*a)+"%"),p="id:"+e[0].id,o=e[0].power,$("#power-switch").prop("checked","on"==o),t(),n.hide(),l.show(),r.show()}))}function t(){$("#power-switch").prop("checked","on"==o),$("#fade-btn").html("Fade "+("off"==o?"on":"off"))}var o,a=localStorage.getItem("lifx_app_token"),i=$(".token-alert"),n=$("#spinner-container"),l=$("#settings-link-container"),c=$("#section-settings"),r=$("#section-main"),p="all";a?($("#lifx_app_token").val(a),e()):(i.show(),l.show(),r.hide(),$("#delete-token").hide(),$(".back-btn").hide(),localStorage.getItem("lifx_app_duration")||$("#delete-all-settings").hide()),localStorage.getItem("lifx_app_duration")&&($("#duration").val(localStorage.getItem("lifx_app_duration")),$("#second").html(localStorage.getItem("lifx_app_duration")>1?"seconds":"second")),localStorage.getItem("lifx_app_quit")&&$("#quit").prop("checked","true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&$("#lock").prop("checked","true"==localStorage.getItem("lifx_app_lock")),window.electron&&$(".electron-only").show(),$(".settings-link").click(function(e){e.preventDefault(),a&&c.is(":visible")?(c.hide(),r.show()):(c.show(),r.hide(),a&&$("#delete-token").show(),(localStorage.getItem("lifx_app_duration")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&$("#delete-all-settings").show())}),$("#save-token").click(function(){$("#lifx_app_token").val()&&(localStorage.setItem("lifx_app_token",$("#lifx_app_token").val()),a=localStorage.getItem("lifx_app_token"),i.hide(),c.hide(),$(".back-btn").show(),e())}),$("#delete-token").click(function(){localStorage.removeItem("lifx_app_token"),a=localStorage.getItem("lifx_app_token"),$("#lifx_app_token").val(a),i.show(),$("#delete-token").hide(),$(".back-btn").hide()}),$("#delete-all-settings").click(function(){$("#delete-token").click(),localStorage.removeItem("lifx_app_duration"),$("#duration").val(0),localStorage.removeItem("lifx_app_quit"),$("#quit").prop("checked",!1),localStorage.removeItem("lifx_app_lock"),$("#lock").prop("checked",!1),$("#delete-all-settings").hide()}),$(".back-btn").click(function(){c.hide(),r.show()}),$("#power-switch").change(function(){a&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+p+"/state",data:{power:"off"==o?"on":"off",duration:0},headers:{Authorization:"Bearer "+a}}).done(function(e){jQuery.isEmptyObject(e)?(alert("Error."),$("#power-switch").prop("checked","on"==o)):(o="off"==o?"on":"off",t())})}),$("#fade-btn").click(function(){a&&$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+p+"/state",data:{power:"off"==o?"on":"off",duration:$("#duration").val()},headers:{Authorization:"Bearer "+a}}).done(function(e){jQuery.isEmptyObject(e)?alert("Error."):(window.electron&&$("#lock").prop("checked")&&window.electron.lock(),window.electron&&$("#quit").prop("checked")?window.electron.quitApp():(o="off"==o?"on":"off",t()))})}),$("#set-duration-0s").click(function(){$("#duration").val(0).change()}),$("#set-duration-1s").click(function(){$("#duration").val(1).change()}),$("#set-duration-5m").click(function(){$("#duration").val(300).change()}),$("#duration").on("input change",function(){localStorage.setItem("lifx_app_duration",$(this).val()),$("#second").html($(this).val()>1?"seconds":"second")}),$("#quit").change(function(){localStorage.setItem("lifx_app_quit",$(this).prop("checked"))}),$("#lock").change(function(){localStorage.setItem("lifx_app_lock",$(this).prop("checked"))}),$("#brightness").on("input change",function(){if(a){var e=$(this).val();$("#current-brightness").html(Math.round(100*e)+"%")}}),$("#brightness").on("change",function(){if(a){var e=$(this).val();$.ajax({method:"PUT",url:"https://api.lifx.com/v1/lights/"+p+"/state",data:{power:"on",brightness:e,duration:0,fast:!0},headers:{Authorization:"Bearer "+a}})}})});