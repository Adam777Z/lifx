"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js"),document.addEventListener("DOMContentLoaded",e=>{function t(){fetch("package.json",{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{e.version&&(document.querySelector("#app-version").textContent="v"+e.version)}).catch(e=>{})}function o(){C=parseInt(document.querySelector("#duration-s").value)+60*parseInt(document.querySelector("#duration-m").value)+60*parseInt(document.querySelector("#duration-h").value)*60,localStorage.setItem("lifx_app_duration_s",document.querySelector("#duration-s").value),localStorage.setItem("lifx_app_duration_m",document.querySelector("#duration-m").value),localStorage.setItem("lifx_app_duration_h",document.querySelector("#duration-h").value)}function l(){document.querySelector("#power-switch").checked="on"==i,document.querySelector("#fade-btn").textContent="Fade "+("off"==i?"on":"off"),E[c].power=i}function a(){d&&(s.style.display="none",u.style.display="none",y.style.display="block",_.style.display="none",f.style.display="none",k.style.display="none",S.style.display="none",fetch("https://api.lifx.com/v1/lights/"+j,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+d},cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{fetch("https://api.lifx.com/v1/lights/"+j,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+d},cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{s.style.display="block",y.style.display="none",document.querySelector("#debug-info").innerHTML=r(JSON.stringify(e,null,4)),document.querySelector("#debug-info").classList.add("border","border-dark","rounded","p-3"),b.dispatchEvent(new Event("change")),E={},w={},L={},e.forEach(function(e){E[e.id]=e,w[e.group.id]=e.group,w[e.group.id].first_light_id=e.id,L[e.location.id]=e.location,L[e.location.id].first_light_id=e.id}),I.querySelectorAll("option:not(:first-child)").forEach(e=>e.remove());for(let[e,t]of Object.entries(L)){let e=document.createElement("option");e.value=t.id,e.text="Location: "+t.name,e.dataset.type="location",I.add(e)}for(let[e,t]of Object.entries(w)){let e=document.createElement("option");e.value=t.id,e.text="Group: "+t.name,e.dataset.type="group",I.add(e)}for(let[e,t]of Object.entries(E)){let e=document.createElement("option");e.value=t.id,e.text="Light: "+t.label,e.dataset.type="light",I.add(e)}localStorage.getItem("lifx_app_selected")&&(I.value=localStorage.getItem("lifx_app_selected")),I.dispatchEvent(new Event("change")),_.style.display="block"}).catch(e=>{s.style.display="block",u.style.display="block",y.style.display="none"})}).catch(e=>{s.style.display="block",u.style.display="block",y.style.display="none"}))}function n(e){if(E[e].connected){let t=E[e].brightness;document.querySelector("#brightness").value=t,document.querySelector("#current-brightness").textContent=Math.round(100*t)+"%",i=E[e].power,document.querySelector("#power-switch").checked="on"==i,l(),f.style.display="block"}else f.style.display="none",k.style.display="block"}function r(e){return e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){let t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}var c,i,d=localStorage.getItem("lifx_app_token"),s=document.querySelector("#top-container"),u=document.querySelector("#error-alert"),p=document.querySelector("#token-alert"),y=document.querySelector("#spinner-container"),g=document.querySelector("#settings-only"),m=document.querySelector("#reload-link"),h=document.querySelector("#section-settings"),_=document.querySelector("#section-lights"),f=document.querySelector("#section-main"),S=document.querySelector("#section-debug"),k=document.querySelector("#section-offline"),v=document.querySelector("#delete-token-btn"),q=document.querySelector("#delete-all-settings-btn"),b=document.querySelector("#debug-enabled"),x=document.querySelector("#back-btn"),I=document.querySelector('select[id="lights"]'),E={},w={},L={},j="all",C=0;d?(document.querySelector("#lifx_app_token").value=d,m.style.display="block",a()):(p.style.display="block",s.style.display="block",f.style.display="none",v.style.display="none",x.style.display="none",localStorage.getItem("lifx_app_debug_enabled")||localStorage.getItem("lifx_app_selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock")||(q.style.display="none")),localStorage.getItem("lifx_app_debug_enabled")&&(b.checked="true"==localStorage.getItem("lifx_app_debug_enabled"),b.dispatchEvent(new Event("change"))),localStorage.getItem("lifx_app_duration_s")&&(document.querySelector("#duration-s").value=localStorage.getItem("lifx_app_duration_s")),localStorage.getItem("lifx_app_duration_m")&&(document.querySelector("#duration-m").value=localStorage.getItem("lifx_app_duration_m")),localStorage.getItem("lifx_app_duration_h")&&(document.querySelector("#duration-h").value=localStorage.getItem("lifx_app_duration_h")),localStorage.getItem("lifx_app_quit")&&(document.querySelector("#quit").checked="true"==localStorage.getItem("lifx_app_quit")),localStorage.getItem("lifx_app_lock")&&(document.querySelector("#lock").checked="true"==localStorage.getItem("lifx_app_lock")),t(),window.electron&&(document.querySelectorAll(".electron-only").forEach(e=>e.style.display=null),"win32"===window.electron.platform&&document.querySelectorAll(".electron-windows-only").forEach(e=>e.style.display=null)),m.addEventListener("click",e=>{e.preventDefault(),a()}),document.querySelectorAll(".settings-link").forEach(e=>e.addEventListener("click",e=>{e.preventDefault(),"none"!=window.getComputedStyle(h).display?(h.style.display="none",g.style.display="none",d&&"none"==window.getComputedStyle(u).display&&(m.style.display="block",I.dispatchEvent(new Event("change")),_.style.display="block")):(h.style.display="block",g.style.display="block",m.style.display="none",_.style.display="none",f.style.display="none",k.style.display="none",d?(v.style.display="block",x.style.display="block"):(v.style.display="none",x.style.display="none"),(localStorage.getItem("lifx_app_debug_enabled")||localStorage.getItem("lifx_app_selected")||localStorage.getItem("lifx_app_duration_s")||localStorage.getItem("lifx_app_duration_m")||localStorage.getItem("lifx_app_duration_h")||localStorage.getItem("lifx_app_quit")||localStorage.getItem("lifx_app_lock"))&&(q.style.display="block"))})),document.querySelector("#save-token").addEventListener("click",e=>{document.querySelector("#lifx_app_token").value?(localStorage.setItem("lifx_app_token",document.querySelector("#lifx_app_token").value),d=localStorage.getItem("lifx_app_token"),u.style.display="none",p.style.display="none",h.style.display="none",g.style.display="none",m.style.display="block",a()):v.click()}),v.addEventListener("click",e=>{localStorage.removeItem("lifx_app_token"),d=localStorage.getItem("lifx_app_token"),document.querySelector("#lifx_app_token").value=d,u.style.display="none",p.style.display="block",v.style.display="none",m.style.display="none",x.style.display="none"}),q.addEventListener("click",e=>{v.click(),localStorage.removeItem("lifx_app_debug_enabled"),b.checked=!1,localStorage.removeItem("lifx_app_selected"),I.value="all",localStorage.removeItem("lifx_app_duration_s"),localStorage.removeItem("lifx_app_duration_m"),localStorage.removeItem("lifx_app_duration_h"),document.querySelector("#duration-s").value=0,document.querySelector("#duration-m").value=0,document.querySelector("#duration-h").value=0,localStorage.removeItem("lifx_app_quit"),document.querySelector("#quit").checked=!1,localStorage.removeItem("lifx_app_lock"),document.querySelector("#lock").checked=!1,q.style.display="none"}),b.addEventListener("change",e=>{e.target.checked?(localStorage.setItem("lifx_app_debug_enabled",e.target.checked),S.style.display="block"):(localStorage.removeItem("lifx_app_debug_enabled"),S.style.display="none")}),x.addEventListener("click",e=>{h.style.display="none",g.style.display="none",m.style.display="block",d&&"none"==window.getComputedStyle(u).display&&(I.dispatchEvent(new Event("change")),_.style.display="block")}),document.querySelector("#power-switch").addEventListener("change",e=>{d&&fetch("https://api.lifx.com/v1/lights/"+j+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+d},body:JSON.stringify({power:"off"==i?"on":"off",duration:0}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{0!==Object.keys(e).length?(i="off"==i?"on":"off",l()):(alert("Error."),document.querySelector("#power-switch").checked="on"==i)}).catch(e=>{})}),document.querySelector("#fade-btn").addEventListener("click",e=>{d&&(o(),fetch("https://api.lifx.com/v1/lights/"+j+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+d},body:JSON.stringify({power:"off"==i?"on":"off",duration:C}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{0!==Object.keys(e).length?(window.electron&&document.querySelector("#lock").checked&&window.electron.lock(),window.electron&&document.querySelector("#quit").checked?window.electron.quitApp():(i="off"==i?"on":"off",l())):alert("Error.")}).catch(e=>{}))}),document.querySelectorAll("#duration-s, #duration-m, #duration-h").forEach(e=>{["input","change"].forEach(t=>{e.addEventListener(t,e=>{o()})})}),document.querySelector("#quit").addEventListener("change",e=>{e.target.checked?localStorage.setItem("lifx_app_quit",e.target.checked):localStorage.removeItem("lifx_app_quit")}),document.querySelector("#lock").addEventListener("change",e=>{e.target.checked?localStorage.setItem("lifx_app_lock",e.target.checked):localStorage.removeItem("lifx_app_lock")}),["input","change"].forEach(e=>document.querySelector("#brightness").addEventListener(e,e=>{if(d){let t=parseFloat(e.target.value);document.querySelector("#current-brightness").textContent=Math.round(100*t)+"%"}})),document.querySelector("#brightness").addEventListener("change",e=>{if(d){let t=parseFloat(e.target.value);fetch("https://api.lifx.com/v1/lights/"+j+"/state",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+d},body:JSON.stringify({power:"on",brightness:t,duration:0,fast:!0}),cache:"no-store"}).then(e=>{if(e.ok)return e.json();throw"Error"}).then(e=>{}).catch(e=>{})}}),I.addEventListener("change",e=>{c=e.target.value,localStorage.setItem("lifx_app_selected",c);let t="all"!=c?e.target.selectedOptions[0].dataset.type:"",o="";"light"==t?o="id:":"group"==t?o="group_id:":"location"==t&&(o="location_id:"),j=o+c,"all"==c?c=e.target.querySelector('option[data-type="light"]').value:"group"==t?c=w[c].first_light_id:"location"==t&&(c=L[c].first_light_id),n(c)})});